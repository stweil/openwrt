#!/bin/sh
klogd
syslogd -C 16 
sysctl -p
echo "S" > /proc/jffs2_bbc

rm -rf /var
ln -sf /tmp /var
mkdir -p /var/run
mkdir -p /var/log
touch /var/log/wtmp
touch /var/log/lastlog

[ "$(nvram get il0macaddr)" = "00:90:4c:5f:00:2a" ] && {
  # if default wifi mac, set two higher than the lan mac
  nvram set il0macaddr=$(nvram get et0macaddr|
  awk '{OFS=FS=":";for(x=7,y=2;--x;){$x=sprintf("%02x",(y+="0x"$x)%256);y/=256}print}')
}

insmod et
insmod wl

ifconfig lo 127.0.0.1 up
ifconfig eth0 promisc

HOSTNAME=$(nvram get wan_hostname)
HOSTNAME=${HOSTNAME%%.*}
echo ${HOSTNAME:=OpenWrt} > /proc/sys/kernel/hostname

vconfig set_name_type VLAN_PLUS_VID_NO_PAD
