# Default target skeleton stuff, may be overridden
DIST=openwrt
TARGET_SKELETON=target/default/skel.tar.gz
TARGET_SKEL_DIR=target/default/target_skeleton

include target/device/Makefile.in

ifeq ($(strip $(BR2_TARGET_ROOTFS_JFFS2)),y)
JFFS2FLAGS+=-a 131072
endif


$(DIST)-linux.trx: openwrt-trx
	PATH=$(TARGET_PATH) trx -o $(DIST)-linux.trx $(LINUX_DIR)/$(LINUX_BINLOC) $(JFFS2FLAGS) $(IMAGE).$(ROOTFS)

$(DIST)-gs-code.bin: openwrt-addpattern $(DIST)-linux.trx
	PATH=$(TARGET_PATH) addpattern -2 -i  $(DIST)-linux.trx -o $(DIST)-gs-code.bin -g

$(DIST)-g-code.bin: $(DIST)-gs-code.bin
	sed -e "1s,^W54S,W54G," < $(DIST)-gs-code.bin > $(DIST)-g-code.bin

openwrt-image:	openwrt $(DIST)-g-code.bin

$(DIST)-image-clean:
	@-rm $(DIST)-* 2>/dev/null
