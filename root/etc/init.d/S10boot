#!/bin/sh
sysctl -p
echo "S" > /proc/jffs2_bbc

mkdir -p /var/run

# networking stub
[ "$(nvram get il0macaddr)" = "00:90:4c:5f:00:2a" ] && {
  # force unique wireless mac
  nvram set il0macaddr=$(nvram get et0macaddr|
  awk -F ":" '{for(x=6,y=2;x;x--){y+=int("0x"$x);$x=sprintf("%02x",y%256);y/=256}gsub(" ",":");print}')
}

insmod et
insmod wl

ifconfig lo 127.0.0.1 up
ifconfig eth0 promisc

HOSTNAME=$(nvram get wan_hostname)
DOMAINNAME=${HOSTNAME##*.}
HOSTNAME=${HOSTNAME%%.*}

echo ${HOSTNAME:=OpenWrt} > /proc/sys/kernel/hostname
echo ${DOMAINNAME:=lan}   > /proc/sys/kernel/domainname

vconfig set_name_type VLAN_PLUS_VID_NO_PAD
