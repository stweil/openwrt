Index: linux-2.6.24.7/arch/mips/Kconfig
===================================================================
--- linux-2.6.24.7.orig/arch/mips/Kconfig	2008-05-07 01:22:34.000000000 +0200
+++ linux-2.6.24.7/arch/mips/Kconfig	2009-01-31 19:21:26.000000000 +0100
@@ -16,6 +16,25 @@
 	prompt "System type"
 	default SGI_IP22
 
+config AR7
+	bool "Texas Instruments AR7"
+	select BROKEN
+	select BOOT_ELF32
+	select DMA_NONCOHERENT
+	select CEVT_R4K
+	select CSRC_R4K
+	select IRQ_CPU
+	select NO_EXCEPT_FILL
+	select SWAP_IO_SPACE
+	select SYS_HAS_CPU_MIPS32_R1
+	select SYS_HAS_EARLY_PRINTK
+	select SYS_SUPPORTS_32BIT_KERNEL
+	select SYS_SUPPORTS_KGDB
+	select SYS_SUPPORTS_LITTLE_ENDIAN
+	select SYS_SUPPORTS_BIG_ENDIAN
+	select GENERIC_GPIO
+	select GENERIC_HARDIRQS_NO__DO_IRQ
+
 config MACH_ALCHEMY
 	bool "Alchemy processor based machines"
 
Index: linux-2.6.24.7/arch/mips/kernel/traps.c
===================================================================
--- linux-2.6.24.7.orig/arch/mips/kernel/traps.c	2008-05-07 01:22:34.000000000 +0200
+++ linux-2.6.24.7/arch/mips/kernel/traps.c	2009-01-31 19:20:31.000000000 +0100
@@ -1093,9 +1093,22 @@
 
 	exception_handlers[n] = handler;
 	if (n == 0 && cpu_has_divec) {
-		*(u32 *)(ebase + 0x200) = 0x08000000 |
-					  (0x03ffffff & (handler >> 2));
-		flush_icache_range(ebase + 0x200, ebase + 0x204);
+		if ((handler ^ (ebase + 4)) & 0xfc000000) {
+			/* lui k0, 0x0000 */
+			*(u32 *)(ebase + 0x200) = 0x3c1a0000 | (handler >> 16);
+			/* ori k0, 0x0000 */
+			*(u32 *)(ebase + 0x204) =
+					0x375a0000 | (handler & 0xffff);
+			/* jr k0 */
+			*(u32 *)(ebase + 0x208) = 0x03400008;
+			/* nop */
+			*(u32 *)(ebase + 0x20C) = 0x00000000;
+			flush_icache_range(ebase + 0x200, ebase + 0x210);
+		} else {
+			*(u32 *)(ebase + 0x200) =
+				0x08000000 | (0x03ffffff & (handler >> 2));
+			flush_icache_range(ebase + 0x200, ebase + 0x204);
+		}
 	}
 	return (void *)old_handler;
 }
Index: linux-2.6.24.7/arch/mips/Makefile
===================================================================
--- linux-2.6.24.7.orig/arch/mips/Makefile	2009-01-31 19:07:19.000000000 +0100
+++ linux-2.6.24.7/arch/mips/Makefile	2009-01-31 19:20:31.000000000 +0100
@@ -159,6 +159,13 @@
 #
 
 #
+# Texas Instruments AR7
+#
+core-$(CONFIG_AR7)		+= arch/mips/ar7/
+cflags-$(CONFIG_AR7)		+= -Iinclude/asm-mips/ar7
+load-$(CONFIG_AR7)		+= 0xffffffff94000000
+
+#
 # Acer PICA 61, Mips Magnum 4000 and Olivetti M700.
 #
 core-$(CONFIG_MACH_JAZZ)	+= arch/mips/jazz/
Index: linux-2.6.24.7/include/asm-mips/page.h
===================================================================
--- linux-2.6.24.7.orig/include/asm-mips/page.h	2008-05-07 01:22:34.000000000 +0200
+++ linux-2.6.24.7/include/asm-mips/page.h	2009-01-31 19:20:31.000000000 +0100
@@ -184,8 +184,10 @@
 #define VM_DATA_DEFAULT_FLAGS	(VM_READ | VM_WRITE | VM_EXEC | \
 				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
 
-#define UNCAC_ADDR(addr)	((addr) - PAGE_OFFSET + UNCAC_BASE)
-#define CAC_ADDR(addr)		((addr) - UNCAC_BASE + PAGE_OFFSET)
+#define UNCAC_ADDR(addr)	((addr) - PAGE_OFFSET + UNCAC_BASE +	\
+				 PHYS_OFFSET)
+#define CAC_ADDR(addr)		((addr) - UNCAC_BASE + PAGE_OFFSET -	\
+				 PHYS_OFFSET)
 
 #include <asm-generic/memory_model.h>
 #include <asm-generic/page.h>
Index: linux-2.6.24.7/drivers/net/Kconfig
===================================================================
--- linux-2.6.24.7.orig/drivers/net/Kconfig	2009-01-31 19:07:18.000000000 +0100
+++ linux-2.6.24.7/drivers/net/Kconfig	2009-01-31 19:20:31.000000000 +0100
@@ -1833,7 +1833,6 @@
 	depends on NET_ETHERNET && EXPERIMENTAL && AR7
 	select PHYLIB
 	select FIXED_PHY
-	select FIXED_MII_100_FDX
 	help
 	  TI AR7 CPMAC Ethernet support
 
Index: linux-2.6.24.7/include/asm-mips/mips-boards/prom.h
===================================================================
--- linux-2.6.24.7.orig/include/asm-mips/mips-boards/prom.h	2008-05-07 01:22:34.000000000 +0200
+++ linux-2.6.24.7/include/asm-mips/mips-boards/prom.h	2009-01-31 19:20:31.000000000 +0100
@@ -27,7 +27,7 @@
 #define _MIPS_PROM_H
 
 extern char *prom_getcmdline(void);
-extern char *prom_getenv(char *name);
+extern char *prom_getenv(const char *name);
 extern void prom_init_cmdline(void);
 extern void prom_meminit(void);
 extern void prom_fixup_mem_map(unsigned long start_mem, unsigned long end_mem);
